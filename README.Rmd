---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "inst/images/"
)
```

# streamnet

Morphology analysis of stream networks 

## Installation

You can install streamnet from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("jsta/streamnet")
```

## Usage

<details>
 <summary>Generate test stream network</summary>

```{r test_dataset}
library(sf)
library(ggplot2)
library(nhdR)
library(streamnet)

data(nhd_sub)

outlet_reach   <- terminal_reaches(network = nhd_sub, approve_all_dl = TRUE)
outlet_point   <- st_cast(st_line_sample(outlet_reach, sample = 1), "POINT")

plot(nhd_sub$geometry)
plot(outlet_reach$geometry, add = TRUE, col = "red", lwd = 2)
plot(outlet_point, add = TRUE)

# avg link_length
nhd_sub_simple <- simplify_network(nhd_sub)
avg_link_length(nhd_sub_simple)
avg_link_length(nhd_sub)

# stream order ratio
res <- stream_order(nhd_sub, outlet = outlet_point)
mapview::mapview(res, zcol = "strahler")

stream_order_ratio(nhd_sub, outlet = outlet_point)

# distance to closest upstream lake
# number of upsream lakes



# calc_metrics(lines)
```
</details>

<details>
 <summary>Calculate stream order</summary>
 
```{r grass_stream-order}
Sys.setenv(GRASS_VERBOSE = -1) # suppress grass messages

res <- stream_order(lines = nhd, outlet = outlet_point, geom_colname = "geometry")

coords <- st_coordinates(st_transform(outlet_point, 4326))
poly   <- nhd_plus_query(coords[1], coords[2], 
                        dsn = "NHDWaterbody")$sp$NHDWaterbody

ggplot() + 
  geom_sf(data = poly, color = "white") +
  geom_sf(data = res, aes(color = as.factor(strahler)))
```
</details>

<details>
  <summary>Calculate average link length</summary>

```{r }  
avg_link_length(lines = nhd, outlet_reach = outlet_reach)
```
</details>

<details>
  <summary>Calculate distance to closest upstream lake</summary>
  
```{r }
1 + 1
```
</details>
